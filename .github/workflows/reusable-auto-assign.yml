name: Reusable Dependabot Auto-Assign

on:
  workflow_call:
    inputs:
      team-slug:
        required: true
        type: string
        description: "The GitHub Team slug (e.g. backend-maintainers)"
    secrets:
      token:
        required: true
        description: "PAT with read:org permissions"

jobs:
  assign-team:
    runs-on: ubuntu-latest
    steps:
      - name: Assign Team Members
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.token }}
          script: |
            const orgName = context.repo.owner;
            const teamSlug = '${{ inputs.team-slug }}';

            try {
              const members = await octokit.rest.teams.listMembersInOrg({
                org: orgName,
                team_slug: teamSlug,
              });

              const logins = members.data.map(m => m.login);
            
              if (logins.length > 0) {
                console.log(`Assigning PR to: ${logins.join(', ')}`);
            
                await octokit.rest.issues.addAssignees({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: context.payload.pull_request.number,
                  assignees: logins
                });
              }
            } catch (error) {
              console.log('Error assigning team members: ' + error.message);
            }